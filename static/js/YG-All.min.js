(function(a){a.fn.ellipsis=function(b){var c=document.documentElement.style;if(!("textOverflow" in c||"OTextOverflow" in c)){return this.each(function(){var f=a(this);if(f.css("overflow")=="hidden"){var i=f.html();var d=f.width();var e=a(this.cloneNode(true)).hide().css({position:"absolute",width:"auto",overflow:"visible","max-width":"inherit"});f.after(e);var h=i;while(h.length>0&&e.width()>f.width()){h=h.substr(0,h.length-1);e.html(h+"...")}f.html(e.html());e.remove();if(b==true){var g=f.width();setInterval(function(){if(f.width()!=g){g=f.width();f.html(i);f.ellipsis()}},200)}}})}else{return this}};a.fn.wait=function(c,b,d){c=c||1000;b=b||"fx";d=d||null;return this.queue(b,function(){var e=this;setTimeout(function(){if(d!=null){d()}a(e).dequeue()},c)})}})(jQuery);(function(a){$.fn.elastic=function(c){var d=$.extend({onResize:function(){}},c);var b=["paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","lineHeight","fontFamily","width","fontWeight"];return this.each(function(){if(this.type!="textarea"){return false}var j=a(this),e=a("<div />").css({position:"absolute",display:"none","word-wrap":"break-word"}),k=parseInt(j.css("line-height"),10)||parseInt(j.css("font-size"),"10"),m=parseInt(j.css("height"),10)||k*3,l=parseInt(j.css("max-height"),10)||Number.MAX_VALUE,f=0,h=0;if(l<0){l=Number.MAX_VALUE}e.appendTo(j.parent());var h=b.length;while(h--){e.css(b[h].toString(),j.css(b[h].toString()))}function n(i,o){curratedHeight=Math.floor(parseInt(i,10));if(j.height()!=curratedHeight){j.css({height:curratedHeight+"px",overflow:o});d.onResize.call(this)}}function g(){var p=j.val().replace(/&/g,"&amp;").replace(/  /g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />");var i=e.html();if(p+"&nbsp;"!=i){e.html(p+"&nbsp;");if(Math.abs(e.height()+k-j.height())>3){var o=e.height()+k;if(o>=l){n(l,"auto")}else{if(o<=m){n(m,"hidden")}else{n(o,"hidden")}}}}}j.css({overflow:"hidden"});j.keyup(function(){g()});j.live("input paste",function(i){setTimeout(g,250)});g()})}})(jQuery);if(jQuery){(function(a){a.extend(a.fn,{uploadify:function(b){a(this).each(function(){settings=a.extend({id:a(this).attr("id"),uploader:"uploadify.swf",script:"uploadify.php",expressInstall:null,folder:"",height:30,width:110,cancelImg:"cancel.png",wmode:"opaque",scriptAccess:"sameDomain",fileDataName:"Filedata",method:"POST",queueSizeLimit:999,simUploadLimit:1,queueID:false,displayData:"percentage",onInit:function(){},onSelect:function(){},onQueueFull:function(){},onCheck:function(){},onCancel:function(){},onError:function(){},onProgress:function(){},onComplete:function(){},onAllComplete:function(){}},b);var e=location.pathname;e=e.split("/");e.pop();e=e.join("/")+"/";var f={};f.uploadifyID=settings.id;f.pagepath=e;if(settings.buttonImg){f.buttonImg=escape(settings.buttonImg)}if(settings.buttonText){f.buttonText=escape(settings.buttonText)}if(settings.rollover){f.rollover=true}f.script=settings.script;f.folder=escape(settings.folder);if(settings.scriptData){var g="";for(var d in settings.scriptData){g+="&"+d+"="+settings.scriptData[d]}f.scriptData=escape(g.substr(1))}f.width=settings.width;f.height=settings.height;f.wmode=settings.wmode;f.method=settings.method;f.queueSizeLimit=settings.queueSizeLimit;f.simUploadLimit=settings.simUploadLimit;if(settings.hideButton){f.hideButton=true}if(settings.fileDesc){f.fileDesc=settings.fileDesc}if(settings.fileExt){f.fileExt=settings.fileExt}if(settings.multi){f.multi=true}if(settings.auto){f.auto=true}if(settings.sizeLimit){f.sizeLimit=settings.sizeLimit}if(settings.checkScript){f.checkScript=settings.checkScript}if(settings.fileDataName){f.fileDataName=settings.fileDataName}if(settings.queueID){f.queueID=settings.queueID}if(settings.onInit()!==false){a(this).css("display","none");a(this).after('<div id="'+a(this).attr("id")+'Uploader"></div>');swfobject.embedSWF(settings.uploader,settings.id+"Uploader",settings.width,settings.height,"9.0.24",settings.expressInstall,f,{quality:"high",wmode:settings.wmode,allowScriptAccess:settings.scriptAccess});if(settings.queueID==false){a("#"+a(this).attr("id")+"Uploader").after('<div id="'+a(this).attr("id")+'Queue" class="uploadifyQueue"></div>')}}if(typeof(settings.onOpen)=="function"){a(this).bind("uploadifyOpen",settings.onOpen)}a(this).bind("uploadifySelect",{action:settings.onSelect,queueID:settings.queueID},function(j,h,i){if(j.data.action(j,h,i)!==false){var k=Math.round(i.size/1024*100)*0.01;var l="KB";if(k>1000){k=Math.round(k*0.001*100)*0.01;l="MB"}var m=k.toString().split(".");if(m.length>1){k=m[0]+"."+m[1].substr(0,2)}else{k=m[0]}if(i.name.length>20){fileName=i.name.substr(0,20)+"..."}else{fileName=i.name}queue="#"+a(this).attr("id")+"Queue";if(j.data.queueID){queue="#"+j.data.queueID}a(queue).append('<div id="'+a(this).attr("id")+h+'" class="uploadifyQueueItem">								<div class="cancel">									<a href="javascript:jQuery(\'#'+a(this).attr("id")+"').uploadifyCancel('"+h+'\')"><img src="'+settings.cancelImg+'" border="0" /></a>								</div>								<span class="fileName">'+fileName+" ("+k+l+')</span><span class="percentage"></span>								<div class="uploadifyProgress">									<div id="'+a(this).attr("id")+h+'ProgressBar" class="uploadifyProgressBar"><!--Progress Bar--></div>								</div>							</div>')}});if(typeof(settings.onSelectOnce)=="function"){a(this).bind("uploadifySelectOnce",settings.onSelectOnce)}a(this).bind("uploadifyQueueFull",{action:settings.onQueueFull},function(h,i){if(h.data.action(h,i)!==false){alert("The queue is full.  The max size is "+i+".")}});a(this).bind("uploadifyCheckExist",{action:settings.onCheck},function(m,l,k,j,o){var i=new Object();i=k;i.folder=e+j;if(o){for(var h in k){var n=h}}a.post(l,i,function(r){for(var p in r){if(m.data.action(m,l,k,j,o)!==false){var q=confirm("Do you want to replace the file "+r[p]+"?");if(!q){document.getElementById(a(m.target).attr("id")+"Uploader").cancelFileUpload(p,true,true)}}}if(o){document.getElementById(a(m.target).attr("id")+"Uploader").startFileUpload(n,true)}else{document.getElementById(a(m.target).attr("id")+"Uploader").startFileUpload(null,true)}},"json")});a(this).bind("uploadifyCancel",{action:settings.onCancel},function(l,h,k,m,j){if(l.data.action(l,h,k,m,j)!==false){var i=(j==true)?0:250;a("#"+a(this).attr("id")+h).fadeOut(i,function(){a(this).remove()})}});if(typeof(settings.onClearQueue)=="function"){a(this).bind("uploadifyClearQueue",settings.onClearQueue)}var c=[];a(this).bind("uploadifyError",{action:settings.onError},function(l,h,k,j){if(l.data.action(l,h,k,j)!==false){var i=new Array(h,k,j);c.push(i);a("#"+a(this).attr("id")+h+" .percentage").text(" - "+j.type+" Error");a("#"+a(this).attr("id")+h).addClass("uploadifyError")}});a(this).bind("uploadifyProgress",{action:settings.onProgress,toDisplay:settings.displayData},function(j,h,i,k){if(j.data.action(j,h,i,k)!==false){a("#"+a(this).attr("id")+h+"ProgressBar").css("width",k.percentage+"%");if(j.data.toDisplay=="percentage"){displayData=" - "+k.percentage+"%"}if(j.data.toDisplay=="speed"){displayData=" - "+k.speed+"KB/s"}if(j.data.toDisplay==null){displayData=" "}a("#"+a(this).attr("id")+h+" .percentage").text(displayData)}});a(this).bind("uploadifyComplete",{action:settings.onComplete},function(k,h,j,i,l){if(k.data.action(k,h,j,unescape(i),l)!==false){a("#"+a(this).attr("id")+h+" .percentage").text(" - Completed");a("#"+a(this).attr("id")+h).fadeOut(250,function(){a(this).remove()})}});if(typeof(settings.onAllComplete)=="function"){a(this).bind("uploadifyAllComplete",{action:settings.onAllComplete},function(h,i){if(h.data.action(h,i)!==false){c=[]}})}})},uploadifySettings:function(f,j,c){var g=false;a(this).each(function(){if(f=="scriptData"&&j!=null){if(c){var i=j}else{var i=a.extend(settings.scriptData,j)}var l="";for(var k in i){l+="&"+k+"="+escape(i[k])}j=l.substr(1)}g=document.getElementById(a(this).attr("id")+"Uploader").updateSettings(f,j)});if(j==null){if(f=="scriptData"){var b=unescape(g).split("&");var e=new Object();for(var d=0;d<b.length;d++){var h=b[d].split("=");e[h[0]]=h[1]}g=e}return g}},uploadifyUpload:function(b){a(this).each(function(){document.getElementById(a(this).attr("id")+"Uploader").startFileUpload(b,false)})},uploadifyCancel:function(b){a(this).each(function(){document.getElementById(a(this).attr("id")+"Uploader").cancelFileUpload(b,true,false)})},uploadifyClearQueue:function(){a(this).each(function(){document.getElementById(a(this).attr("id")+"Uploader").clearFileUploadQueue(false)})}})})(jQuery)}var swfobject=function(){var aq="undefined",aD="object",ab="Shockwave Flash",X="ShockwaveFlash.ShockwaveFlash",aE="application/x-shockwave-flash",ac="SWFObjectExprInst",ax="onreadystatechange",af=window,aL=document,aB=navigator,aa=false,Z=[aN],aG=[],ag=[],al=[],aJ,ad,ap,at,ak=false,aU=false,aH,an,aI=true,ah=function(){var a=typeof aL.getElementById!=aq&&typeof aL.getElementsByTagName!=aq&&typeof aL.createElement!=aq,e=aB.userAgent.toLowerCase(),c=aB.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(e),j=c?/mac/.test(c):/mac/.test(e),g=/webkit/.test(e)?parseFloat(e.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,d=!+"\v1",f=[0,0,0],k=null;if(typeof aB.plugins!=aq&&typeof aB.plugins[ab]==aD){k=aB.plugins[ab].description;if(k&&!(typeof aB.mimeTypes!=aq&&aB.mimeTypes[aE]&&!aB.mimeTypes[aE].enabledPlugin)){aa=true;d=false;k=k.replace(/^.*\s+(\S+\s+\S+$)/,"$1");f[0]=parseInt(k.replace(/^(.*)\..*$/,"$1"),10);f[1]=parseInt(k.replace(/^.*\.(.*)\s.*$/,"$1"),10);f[2]=/[a-zA-Z]/.test(k)?parseInt(k.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof af.ActiveXObject!=aq){try{var i=new ActiveXObject(X);if(i){k=i.GetVariable("$version");if(k){d=true;k=k.split(" ")[1].split(",");f=[parseInt(k[0],10),parseInt(k[1],10),parseInt(k[2],10)]}}}catch(b){}}}return{w3:a,pv:f,wk:g,ie:d,win:h,mac:j}}(),aK=function(){if(!ah.w3){return}if((typeof aL.readyState!=aq&&aL.readyState=="complete")||(typeof aL.readyState==aq&&(aL.getElementsByTagName("body")[0]||aL.body))){aP()}if(!ak){if(typeof aL.addEventListener!=aq){aL.addEventListener("DOMContentLoaded",aP,false)}if(ah.ie&&ah.win){aL.attachEvent(ax,function(){if(aL.readyState=="complete"){aL.detachEvent(ax,arguments.callee);aP()}});if(af==top){(function(){if(ak){return}try{aL.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}aP()})()}}if(ah.wk){(function(){if(ak){return}if(!/loaded|complete/.test(aL.readyState)){setTimeout(arguments.callee,0);return}aP()})()}aC(aP)}}();function aP(){if(ak){return}try{var b=aL.getElementsByTagName("body")[0].appendChild(ar("span"));b.parentNode.removeChild(b)}catch(a){return}ak=true;var d=Z.length;for(var c=0;c<d;c++){Z[c]()}}function aj(a){if(ak){a()}else{Z[Z.length]=a}}function aC(a){if(typeof af.addEventListener!=aq){af.addEventListener("load",a,false)}else{if(typeof aL.addEventListener!=aq){aL.addEventListener("load",a,false)}else{if(typeof af.attachEvent!=aq){aM(af,"onload",a)}else{if(typeof af.onload=="function"){var b=af.onload;af.onload=function(){b();a()}}else{af.onload=a}}}}}function aN(){if(aa){Y()}else{am()}}function Y(){var d=aL.getElementsByTagName("body")[0];var b=ar(aD);b.setAttribute("type",aE);var a=d.appendChild(b);if(a){var c=0;(function(){if(typeof a.GetVariable!=aq){var e=a.GetVariable("$version");if(e){e=e.split(" ")[1].split(",");ah.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)]}}else{if(c<10){c++;setTimeout(arguments.callee,10);return}}d.removeChild(b);a=null;am()})()}else{am()}}function am(){var g=aG.length;if(g>0){for(var h=0;h<g;h++){var c=aG[h].id;var l=aG[h].callbackFn;var a={success:false,id:c};if(ah.pv[0]>0){var i=aS(c);if(i){if(ao(aG[h].swfVersion)&&!(ah.wk&&ah.wk<312)){ay(c,true);if(l){a.success=true;a.ref=av(c);l(a)}}else{if(aG[h].expressInstall&&au()){var e={};e.data=aG[h].expressInstall;e.width=i.getAttribute("width")||"0";e.height=i.getAttribute("height")||"0";if(i.getAttribute("class")){e.styleclass=i.getAttribute("class")}if(i.getAttribute("align")){e.align=i.getAttribute("align")}var f={};var d=i.getElementsByTagName("param");var k=d.length;for(var j=0;j<k;j++){if(d[j].getAttribute("name").toLowerCase()!="movie"){f[d[j].getAttribute("name")]=d[j].getAttribute("value")}}ae(e,f,c,l)}else{aF(i);if(l){l(a)}}}}}else{ay(c,true);if(l){var b=av(c);if(b&&typeof b.SetVariable!=aq){a.success=true;a.ref=b}l(a)}}}}}function av(b){var d=null;var c=aS(b);if(c&&c.nodeName=="OBJECT"){if(typeof c.SetVariable!=aq){d=c}else{var a=c.getElementsByTagName(aD)[0];if(a){d=a}}}return d}function au(){return !aU&&ao("6.0.65")&&(ah.win||ah.mac)&&!(ah.wk&&ah.wk<312)}function ae(f,d,h,e){aU=true;ap=e||null;at={success:false,id:h};var a=aS(h);if(a){if(a.nodeName=="OBJECT"){aJ=aO(a);ad=null}else{aJ=a;ad=h}f.id=ac;if(typeof f.width==aq||(!/%$/.test(f.width)&&parseInt(f.width,10)<310)){f.width="310"}if(typeof f.height==aq||(!/%$/.test(f.height)&&parseInt(f.height,10)<137)){f.height="137"}aL.title=aL.title.slice(0,47)+" - Flash Player Installation";var b=ah.ie&&ah.win?"ActiveX":"PlugIn",c="MMredirectURL="+af.location.toString().replace(/&/g,"%26")+"&MMplayerType="+b+"&MMdoctitle="+aL.title;if(typeof d.flashvars!=aq){d.flashvars+="&"+c}else{d.flashvars=c}if(ah.ie&&ah.win&&a.readyState!=4){var g=ar("div");h+="SWFObjectNew";g.setAttribute("id",h);a.parentNode.insertBefore(g,a);a.style.display="none";(function(){if(a.readyState==4){a.parentNode.removeChild(a)}else{setTimeout(arguments.callee,10)}})()}aA(f,d,h)}}function aF(a){if(ah.ie&&ah.win&&a.readyState!=4){var b=ar("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(aO(a),b);a.style.display="none";(function(){if(a.readyState==4){a.parentNode.removeChild(a)}else{setTimeout(arguments.callee,10)}})()}else{a.parentNode.replaceChild(aO(a),a)}}function aO(b){var d=ar("div");if(ah.win&&ah.ie){d.innerHTML=b.innerHTML}else{var e=b.getElementsByTagName(aD)[0];if(e){var a=e.childNodes;if(a){var f=a.length;for(var c=0;c<f;c++){if(!(a[c].nodeType==1&&a[c].nodeName=="PARAM")&&!(a[c].nodeType==8)){d.appendChild(a[c].cloneNode(true))}}}}}return d}function aA(e,g,c){var d,a=aS(c);if(ah.wk&&ah.wk<312){return d}if(a){if(typeof e.id==aq){e.id=c}if(ah.ie&&ah.win){var f="";for(var i in e){if(e[i]!=Object.prototype[i]){if(i.toLowerCase()=="data"){g.movie=e[i]}else{if(i.toLowerCase()=="styleclass"){f+=' class="'+e[i]+'"'}else{if(i.toLowerCase()!="classid"){f+=" "+i+'="'+e[i]+'"'}}}}}var h="";for(var j in g){if(g[j]!=Object.prototype[j]){h+='<param name="'+j+'" value="'+g[j]+'" />'}}a.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>";ag[ag.length]=e.id;d=aS(e.id)}else{var b=ar(aD);b.setAttribute("type",aE);for(var k in e){if(e[k]!=Object.prototype[k]){if(k.toLowerCase()=="styleclass"){b.setAttribute("class",e[k])}else{if(k.toLowerCase()!="classid"){b.setAttribute(k,e[k])}}}}for(var l in g){if(g[l]!=Object.prototype[l]&&l.toLowerCase()!="movie"){aQ(b,l,g[l])}}a.parentNode.replaceChild(b,a);d=b}}return d}function aQ(b,d,c){var a=ar("param");a.setAttribute("name",d);a.setAttribute("value",c);b.appendChild(a)}function aw(a){var b=aS(a);if(b&&b.nodeName=="OBJECT"){if(ah.ie&&ah.win){b.style.display="none";(function(){if(b.readyState==4){aT(a)}else{setTimeout(arguments.callee,10)}})()}else{b.parentNode.removeChild(b)}}}function aT(a){var b=aS(a);if(b){for(var c in b){if(typeof b[c]=="function"){b[c]=null}}b.parentNode.removeChild(b)}}function aS(a){var c=null;try{c=aL.getElementById(a)}catch(b){}return c}function ar(a){return aL.createElement(a)}function aM(a,c,b){a.attachEvent(c,b);al[al.length]=[a,c,b]}function ao(a){var b=ah.pv,c=a.split(".");c[0]=parseInt(c[0],10);c[1]=parseInt(c[1],10)||0;c[2]=parseInt(c[2],10)||0;return(b[0]>c[0]||(b[0]==c[0]&&b[1]>c[1])||(b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]))?true:false}function az(b,f,a,c){if(ah.ie&&ah.mac){return}var e=aL.getElementsByTagName("head")[0];if(!e){return}var g=(a&&typeof a=="string")?a:"screen";if(c){aH=null;an=null}if(!aH||an!=g){var d=ar("style");d.setAttribute("type","text/css");d.setAttribute("media",g);aH=e.appendChild(d);if(ah.ie&&ah.win&&typeof aL.styleSheets!=aq&&aL.styleSheets.length>0){aH=aL.styleSheets[aL.styleSheets.length-1]}an=g}if(ah.ie&&ah.win){if(aH&&typeof aH.addRule==aD){aH.addRule(b,f)}}else{if(aH&&typeof aL.createTextNode!=aq){aH.appendChild(aL.createTextNode(b+" {"+f+"}"))}}}function ay(a,c){if(!aI){return}var b=c?"visible":"hidden";if(ak&&aS(a)){aS(a).style.visibility=b}else{az("#"+a,"visibility:"+b)}}function ai(b){var a=/[\\\"<>\.;]/;var c=a.exec(b)!=null;return c&&typeof encodeURIComponent!=aq?encodeURIComponent(b):b}var aR=function(){if(ah.ie&&ah.win){window.attachEvent("onunload",function(){var a=al.length;for(var b=0;b<a;b++){al[b][0].detachEvent(al[b][1],al[b][2])}var d=ag.length;for(var c=0;c<d;c++){aw(ag[c])}for(var e in ah){ah[e]=null}ah=null;for(var f in swfobject){swfobject[f]=null}swfobject=null})}}();return{registerObject:function(a,e,c,b){if(ah.w3&&a&&e){var d={};d.id=a;d.swfVersion=e;d.expressInstall=c;d.callbackFn=b;aG[aG.length]=d;ay(a,false)}else{if(b){b({success:false,id:a})}}},getObjectById:function(a){if(ah.w3){return av(a)}},embedSWF:function(k,e,h,f,c,a,b,i,g,j){var d={success:false,id:e};if(ah.w3&&!(ah.wk&&ah.wk<312)&&k&&e&&h&&f&&c){ay(e,false);aj(function(){h+="";f+="";var q={};if(g&&typeof g===aD){for(var o in g){q[o]=g[o]}}q.data=k;q.width=h;q.height=f;var n={};if(i&&typeof i===aD){for(var p in i){n[p]=i[p]}}if(b&&typeof b===aD){for(var l in b){if(typeof n.flashvars!=aq){n.flashvars+="&"+l+"="+b[l]}else{n.flashvars=l+"="+b[l]}}}if(ao(c)){var m=aA(q,n,e);if(q.id==e){ay(e,true)}d.success=true;d.ref=m}else{if(a&&au()){q.data=a;ae(q,n,e,j);return}else{ay(e,true)}}if(j){j(d)}})}else{if(j){j(d)}}},switchOffAutoHideShow:function(){aI=false},ua:ah,getFlashPlayerVersion:function(){return{major:ah.pv[0],minor:ah.pv[1],release:ah.pv[2]}},hasFlashPlayerVersion:ao,createSWF:function(a,b,c){if(ah.w3){return aA(a,b,c)}else{return undefined}},showExpressInstall:function(b,a,d,c){if(ah.w3&&au()){ae(b,a,d,c)}},removeSWF:function(a){if(ah.w3){aw(a)}},createCSS:function(b,a,c,d){if(ah.w3){az(b,a,c,d)}},addDomLoadEvent:aj,addLoadEvent:aC,getQueryParamValue:function(b){var a=aL.location.search||aL.location.hash;if(a){if(/\?/.test(a)){a=a.split("?")[1]}if(b==null){return ai(a)}var c=a.split("&");for(var d=0;d<c.length;d++){if(c[d].substring(0,c[d].indexOf("="))==b){return ai(c[d].substring((c[d].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(aU){var a=aS(ac);if(a&&aJ){a.parentNode.replaceChild(aJ,a);if(ad){ay(ad,true);if(ah.ie&&ah.win){aJ.style.display="block"}}if(ap){ap(at)}}aU=false}}}}();var gen=new Object();gen.removePermDisplay=true;gen.ajaxReceive=null;gen.hashArray=null;gen.hashTabArray=null;gen.ajaxSendMessage="Saving...";$(function(){gen.setupAjaxErrorSuccess()});gen.json=function(b,d,a,c){c=c||"Saving...";d.time=(new Date()).getTime();gen.ajaxReceive=a;gen.ajaxSendMessage=c;$.getJSON(b,d,a);gen.ajaxSendMessage="Saving..."};gen.jsonPost=function(b,d,a,c){c=c||"Saving...";var e=(new Date()).getTime();gen.ajaxReceive=a;gen.ajaxSendMessage=c;$.post(b+"?time="+e,d,a,"json");gen.ajaxSendMessage="Saving..."};gen.setupAjaxErrorSuccess=function(){$("#statusUpdateBar").ajaxError(function(c,b,a){gen.removePermDisplay=false;gen.statusPermDisplay("There was an error contacting the server... ","Try again",function(){$.getJSON(a.url,function(d){gen.ajaxReceive(d);$("#statusUpdateBar").fadeOut("slow",gen.fadeInGroupTitleBar)})},"error");gen.removePermDisplay=true;$(this).data("AjaxError",true)});$("#statusUpdateBar").ajaxSuccess(function(){if($(this).data("AjaxError")==true){$(this).fadeOut("slow",gen.fadeInGroupTitleBar).data("AjaxError",false)}});$("#ajaxStatus").ajaxSend(function(){$(this).removeClass("ui-state-highlight").addClass("ui-state-error").html(gen.ajaxSendMessage).show()});$("#ajaxStatus").ajaxError(function(){$(this).fadeOut(1000)});$("#ajaxStatus").ajaxSuccess(function(){$(this).addClass("ui-state-highlight").removeClass("ui-state-error").html("Success!").wait(1000).fadeOut("1000")})};gen.statusTempDisplay=function(b){var a=$("#statusUpdateBar");if(arguments.length==2){a.addClass("ui-state-error")}else{a.removeClass("ui-state-error")}gen.hideGroupTitleBar();a.html(b).show().wait(5000).fadeOut("slow",gen.fadeInGroupTitleBar)};gen.statusPermDisplay=function(e,c,a){var b=$("#statusUpdateBar");var d=$('<a href="">'+c+"</a>").click(a);if(arguments.length==4){b.addClass("ui-state-error")}else{b.removeClass("ui-state-error")}gen.hideGroupTitleBar();b.html(e+" ").append(d).show();if(gen.removePermDisplay){b.click(function(){$(this).wait(5000).fadeOut("slow",gen.fadeInGroupTitleBar);return false})}else{b.click(function(){return false})}};gen.fadeInGroupTitleBar=function(){$("#groupTitleBar").fadeIn()};gen.hideGroupTitleBar=function(){$("#groupTitleBar").hide()};gen.button=function(e,d,c,a){var b=$("#"+e);b.unbind("click").click(c);if(d!=""){b.html(d)}return b};gen.restyleErrorForm=function(a){$.each(a.error_keys,function(b,c){$("#id_"+c).css({"margin-top":"0",border:"1px solid red"})})};gen.scrollWithTextarea=function(c){var a=$("#"+c);var b=a.attr("scrollTop");a.attr("scrollTop",(b+15))};gen.restyleFormErrors=function(a){$.each(a.errors,function(b,c){$("#id_"+c).addClass("errorField")})};gen.setHash=function(a){window.location.hash=a};gen.loadHash=function(){gen.hashArray=window.location.hash.toLowerCase().split("/");gen.hashTabArray=gen.hashArray.slice().slice(2,gen.hashArray.length);if(gen.hashArray.length==0||gen.hashArray[0]==""){return}tabCalls={calendar:null,discuss:discuss.loadHash,files:files.loadHash};tabCalls[gen.hashArray[1]]()};var site=new Object();site.id=null;site.url=null;site.media_url=null;site.user=null;site.settingsBox="+";site.settingsBoxDisplayed=false;site.new_site=null;$(function(){site.getAllSiteInfo();site.tabs=$("#tabs").tabs();$("#tabs").bind("tabsselect",function(b,c){var a=["/Calendar","/Discuss","/Files"];gen.setHash(a[c.index])});$("#settingsLink").toggle(site.toggleSettingsBoxDisplay,site.toggleSettingsBoxDisplay);$("#stepsModal").dialog({autoOpen:false,resizable:false,modal:true,show:"fold",hide:"fold",closeOnEscape:false,draggable:false});site.setupStepsLinks()});site.getSiteID=function(){gen.json(window.location.pathname+"/site/getSiteID/",{},function(a){site.id=a.site});return site.id};site.siteID=function(){if(site.id==null){return site.getSiteID()}else{return site.id}};site.getAllSiteInfo=function(){gen.json(window.location.pathname+"/site/getAllSiteInfo/",{},function(a){site.id=a.site;site.url=a.url;site.media_url=a.media_url;site.user=a.user;discuss.loadData(a.discuss);site.loadSettingsBoxData(a.settings_box);files.loadData(a.files);gen.loadHash()})};site.loadSettingsBoxData=function(a){if(a.show_settings){site.toggleSettingsBoxDisplay()}if(a.name_changed){$("#stepsTable th:nth-child(2)").html("Step 2 (Done):").css("text-decoration","line-through");$("#stepsTable td:nth-child(2)").html("Site has been renamed")}if(!a.group_leader){$("#stepsTable").html('<tr><th>Welcome to YakGroups!</th></tr><tr><td><a id="quickTourLink" href="">Quick 1-minute Tour of YakGroups</a><div class="stepsTableButton"><button id="stepsTableButton" type="button" class="ui-state-default">Done</button></div></td></tr>').addClass("stepsTable2");$("#quickTourLink").click(site.loadQuickTour);$("#settingsBox").addClass("settingsBox2");$("#stepsTableButton").click(site.toggleSettingsBoxDisplay);$("#settingsLink").html("Help")}if(a.new_site){site.new_site=a.new_site}};site.toggleSettingsBoxDisplay=function(){if(site.settingsBox=="+"){var a=false;site.settingsBoxDisplayed=true;todo.toggleToDoListTut("hide");$("#subHeader, #todoListHeader, #todoList, #vDivider, #tabs").animate({top:site.settingsBox+"=300px"},"slow",function(){if(!a){$("#settingsBox").fadeIn(function(){if(site.new_site){site.loadAddGroupMembersForm();site.new_site=false}})}a=true;site.settingsBox="-"});$("#todoDetails").animate({top:"410px"},"slow");$("#stepsTableButton").click(site.toggleSettingsBoxDisplay)}else{site.settingsBoxDisplayed=false;$("#settingsBox").fadeOut(function(){$("#subHeader, #todoListHeader, #todoList, #vDivider, #tabs").animate({top:site.settingsBox+"=300px"},"slow");$("#todoDetails").animate({top:"110px"},"slow",function(){todo.toggleToDoListTut("show");$("#settingsLink").animate({backgroundColor:"#FACC14"},500).animate({backgroundColor:"white"},2500)});data={site:site.siteID()};gen.json(window.location.pathname+"/members/disableShowSettingsBox/",data,function(b){});site.settingsBox="+"})}};site.setupStepsLinks=function(){$("#addGroupMembersLink").click(site.loadAddGroupMembersForm);$("#nameSiteLink").click(site.loadRenameSiteForm);$("#quickTourLink").click(site.loadQuickTour)};site.loadQuickTour=function(){data={site:site.siteID()};gen.json(window.location.pathname+"/site/loadQuickTour/",data,function(a){$("#stepsModalContent").html(a.content);$("#stepsModal").dialog("option",{title:"Step 3: Quick Tour",height:500,width:600,buttons:{Close:function(){$(this).dialog("close")}}}).dialog("open")},"Loading...");return false};site.loadAddGroupMembersForm=function(){data={site:site.siteID()};gen.json(window.location.pathname+"/members/addGroupMembers/",data,function(a){site.setupAddGroupMembersForm(a);$("#stepsModal").dialog("option",{title:"Step 1: Add Group Members",height:400,width:600,buttons:{"Add Group Members Later":function(){$(this).dialog("close")},"Save and Email New Members":function(){$("#submitType").val("saveSubmit");site.submitAddGroupMembersForm()}}}).dialog("open")},"Loading...");return false};site.setupAddGroupMembersForm=function(a){$("#stepsModalContent").html(a.form);$("#addGroupMembersForm").submit(site.submitAddGroupMembersForm);$("#addRowSubmit").click(function(){$("#submitType").val("addRowSubmit");site.submitAddGroupMembersForm()});$("#removeRowSubmit").click(function(){$("#submitType").val("removeRowSubmit");site.submitAddGroupMembersForm()})};site.submitAddGroupMembersForm=function(){var a=$("#addGroupMembersForm").serialize();gen.jsonPost(window.location.pathname+"/members/addGroupMembers/",a,function(b){if(b.s){$("#stepsModal").dialog("close");$("#stepsTable th:nth-child(1)").html("Step 1 (Done):").css("text-decoration","line-through")}else{site.setupAddGroupMembersForm(b)}});return false};site.loadRenameSiteForm=function(){data={site:site.siteID()};gen.json(window.location.pathname+"/site/renameSite/",data,function(a){$("#stepsModalContent").html(a.form);$("#renameSiteForm #id_name").keyup(site.updateRenameSiteForm).focus();$("#stepsModal").dialog("option",{title:"Step 2: Name your YakGroups Site",height:300,width:600,buttons:{"Rename Site Later":function(){$(this).dialog("close")},Save:function(){site.submitRenameSiteForm()}}}).dialog("open")},"Loading...");return false};site.submitRenameSiteForm=function(){$("submitType").val("save");var a=$("#renameSiteForm").serialize();gen.jsonPost(window.location.pathname+"/site/renameSite/",a,function(b){if(b.s){$("#stepsModal").dialog("close");$("#stepsTable th:nth-child(2)").html("Step 2 (Done):").css("text-decoration","line-through");$("#stepsTable td:nth-child(2)").html("Site has been renamed");$("#groupTitleBar").html(b.title).fadeIn("slow")}else{$("#stepsModalContent").html(b.form);$("#renameSiteForm #id_name").keyup(site.updateRenameSiteForm);gen.restyleFormErrors(b)}});return false};site.updateRenameSiteForm=function(){var a=/\W/;var b=$("#renameSiteForm #id_name").val();if(a.test(b)){$("#potentialSiteName > ul").remove();$("#potentialSiteName").prepend('<ul class="errorlist"><li>Only letters, numbers, and underscores allowed. No spaces.</li></ul>');$("#potentialSiteName #id_name").addClass("errorField")}else{$("#potentialSiteName > ul").remove();$("#potentialSiteName #id_name").removeClass("errorField")}};var todo=new Object();todo.isActive=true;var draggableExist=false;var newDraggable;var $todoList;var $calCells;var helperClone;var todoItemTemplate;var quickAddInput;$(function(){$todoList=$("#todoList");$bodyTag=$("body");todoItemTemplate=$("#todoItemTemplate");quickAddInput=$("#quickAddInput");todo.setupToDoList();todo.setupQuickAddForm();todo.getAllToDos()});todo.details=null;todo.detailsDivHeight=0;todo.allToDos=new Array(0);todo.setupToDoList=function(){$todoList.sortable({axis:"y",tolerance:"pointer",sort:todo.todoListSortingFunct,update:todo.reorderToDos,stop:function(a,b){b.item.show();if(draggableExist){newDraggable.remove();helperClone.remove()}draggableExists=false}});$(".todoCheckBox").live("click",todo.toggleCompleteStatus);$(".todoCheckBox").live("mouseover",function(){if($(this).parent().data("complete")==0){$(this).children(".todoCheckOff").addClass("todoCheckHover")}});$(".todoCheckBox").live("mouseout",function(){if($(this).parent().data("complete")==0){$(this).children(".todoCheckOff").removeClass("todoCheckHover")}});$(".todo").live("click",todo.showToDoDetails);$(".calEvent").live("click",todo.showToDoDetails);$("#todoDetailsClose").click(todo.hideToDoDetails)};todo.setupQuickAddForm=function(){$("#addTodoForm").submit(todo.quickAddSend)};todo.quickAddSend=function(){var b;var a=quickAddInput.val();if(jQuery.trim(a)==""){return false}b={site:site.siteID(),title:a};gen.json(window.location.pathname+"/todos/",b,function(c){todo.addNewToDoItem(c,false);quickAddInput.val("").focus();todo.toggleToDoListTut("hide")});return false};todo.createNewToDoItem=function(d){var a=todoItemTemplate.clone();var c="";var b="&nbsp;";(d.pretty_time!="")?c=d.pretty_time+" ":c="";if(d.members.length!=0){b="Assigned To: ";$.each(d.members,function(e,f){b=b+f;if((e+1)!=d.members.length){b=b+", "}})}a.attr("id","todo_"+d.id).removeClass("hidden").children(".todoTitle").attr("id","todoTitle_"+d.id).html("<span>"+d.title+"</span>").end().children(".todoBottom").children(".todoAssignedMembers").attr("id","todoAssignedMembers_"+d.id).html(b).end().children(".todoDueDate").attr("id","todoDueDate_"+d.id).html(c+d.pretty_date);return a};todo.configureToDoItem=function(a){$("#todoTitle_"+a.id).ellipsis();$("#todo_"+a.id).data("id",a.id);$("#todo_"+a.id+" .todoExpand").data("id",a.id);todo.toggleToDoCheckmark(a)};todo.updateToDoItem=function(a){$("#todo_"+a.id).replaceWith(todo.createNewToDoItem(a));if(todo.details!=null){$("#todo_"+a.id).addClass("droppableHover")}todo.configureToDoItem(a);todo["id_"+a.id]=a};todo.addNewToDoItem=function(a,b){var c=0;if(!b){c=$todoList.attr("scrollHeight")}$todoList.append(todo.createNewToDoItem(a)).attr({scrollTop:c});todo["id_"+a.id]=a;todo.allToDos.push("id_"+a.id);cal.updateCalEvent(a.id);todo.configureToDoItem(a)};todo.todoListSortingFunct=function(b,a){if(b.pageX>328){if(!draggableExist){draggableExist=true;newDraggable=$("<div>"+a.item.children(".todoTitle").html()+"</div>").addClass("todoDraggable").addClass("ui-state-hover").appendTo($bodyTag).ellipsis().css({top:b.pageY,left:b.pageX});helperClone=a.item.clone().appendTo($bodyTag).css({top:a.offset.top,left:11}).animate({top:a.placeholder.offset().top},500);a.item.hide()}else{newDraggable.css({top:b.pageY,left:b.pageX})}}else{if(draggableExist){draggableExist=false;newDraggable.remove();helperClone.remove();a.item.show()}}};todo.getAllToDos=function(){data={site:null};gen.json(window.location.pathname+"/todos/getAllToDos/",data,function(a){$.each(a,function(b,c){todo.addNewToDoItem(c,true)});cal.createAllEvents();todo.toggleToDoListTut("show")},"Loading ToDo List...")};todo.toggleToDoListTut=function(a){if(a=="show"&&!site.settingsBoxDisplayed&&todo.allToDos.length==0){$("#todoListTut").fadeIn()}else{$("#todoListTut").hide()}};todo.reorderToDos=function(){var a=$todoList.sortable("serialize");data={site:site.siteID(),order:"serial"};gen.json(window.location.pathname+"/todos/reorderToDos/?"+a,data,function(b){})};todo.toggleCompleteStatus=function(){var a=$(this).parent();var b=a.data("id");data={site:site.siteID(),id:b,complete:a.data("complete")};gen.json(window.location.pathname+"/todos/toggleCompleteStatus/",data,todo.toggleToDoCheckmark);return false};todo.toggleToDoCheckmark=function(c){var b=$("#todo_"+c.id);var a=b.children(".todoCheckBox").children("span");if(c.complete==0){b.removeClass("todoComplete");a.removeClass("todoCheckOn");a.addClass("todoCheckOff")}else{b.addClass("todoComplete");a.addClass("todoCheckOn");a.removeClass("todoCheckOff")}a.removeClass("todoCheckHover");b.data("complete",c.complete);if(todo.details&&todo.details.id==c.id){todo.details.complete=c.complete;if(c.complete==1){$("#todoDetailsCompleteStatus_"+c.id).html("Yes");$("#id_complete").attr("checked",true)}else{if(c.complete==0){$("#todoDetailsCompleteStatus_"+c.id).html("No");$("#id_complete").attr("checked",false)}}}};todo.showToDoDetails=function(c,d){var a=$(this);var b=a.data("id");if(!todo.isActive){return false}todo.loadToDoDetails(b);$("#todoList div").removeClass("droppableHover");$("#todo_"+b).addClass("droppableHover");return false};todo.hideToDoDetails=function(){$("#todoDetails").hide();todo.details=null;$("#tabs").show();$("#todoList div").removeClass("droppableHover");return false};todo.loadToDoDetails=function(a){data={site:site.siteID(),id:a};gen.json(window.location.pathname+"/todos/viewmodifyToDoDetails/",data,function(b){todo.details=b;$("#todoDetails").show();$("#tabs").hide();$("#todoDetailsTable").html(b.table).attr("scrollTop",0);$("#modifyToDoDetailsFormContent").html(b.form);todo.createViewToDoDetailsTable()},"Loading...")};todo.sendModifyToDoDetailsForm=function(){var a=$("#modifyToDoDetailsForm").serialize();gen.jsonPost(window.location.pathname+"/todos/viewmodifyToDoDetails/",a,function(b){var c=$("#todoDetailsForm").attr("scrollTop");todo.details=b;if(b.form_success){$("#todoDetailsTable").html(b.table);$("#modifyToDoDetailsFormContent").html(b.form);todo.createViewToDoDetailsTable();$("#todoDetailsTable").attr("scrollTop",(c+10));todo.updateToDoItem(b);cal.updateCalEvent(b.id)}else{$("#modifyToDoDetailsFormContent").html(b.form);todo.createModifyToDoDetailsForm();todo.restyleModifyToDoDetailsForm();$("#todoDetailsForm").attr("scrollTop",($("#modifyToDoDetailsFormContent ul.errorlist:first").position().top-10))}});return false};todo.createViewToDoDetailsTable=function(){var c=todo.details;var a=$("#todoDetailsTable");var b=$("#todoDetailsForm");var d=b.attr("scrollTop");$("#todoDetailsHeader").html("ToDo Details: "+c.title);b.hide();a.show().attr("scrollTop",d);$("#todoDetailsActionButton").html("Edit").unbind("click").click(todo.createModifyToDoDetailsForm);$("#todoDetailsCancelButton").html("Close").unbind("click").click(todo.hideToDoDetails);todo.configureRelatedTopicsTable();todo.configureRelatedFilesTable()};todo.createModifyToDoDetailsForm=function(){var c=todo.details;var a=$("#todoDetailsTable");var b=$("#todoDetailsForm");var d=a.attr("scrollTop");$("#todoDetailsHeader").html("Edit: "+c.title);a.hide();b.show();$("#id_id").val(c.id);$("#modifyToDoDetailsForm").submit(todo.sendModifyToDoDetailsForm);$("#todoDetailsActionButton").html("Save").unbind("click").click(todo.sendModifyToDoDetailsForm);$("#todoDetailsCancelButton").html("Cancel").unbind("click").click(todo.createViewToDoDetailsTable);$("#id_description").elastic({onResize:function(){var f=$("#todoDetailsForm");var i=todo.detailsDivHeight;var e=f.attr("scrollHeight");var g=(e-i);var h=f.attr("scrollTop");todo.detailsDivHeight=f.attr("scrollHeight");f.attr("scrollTop",(h+g))}});todo.detailsDivHeight=b.attr("scrollHeight");b.attr("scrollTop",d);todo.configureRelatedTopicsTable();todo.configureRelatedFilesTable()};todo.restyleModifyToDoDetailsForm=function(){var a=todo.details;$.each(a.error_keys,function(b,c){$("#id_"+c).css({"margin-top":"0",border:"1px solid red"})})};todo.removeRelatedTopic=function(a,b){var c={site:site.siteID(),item:a,todo:b};gen.jsonPost(window.location.pathname+"/todos/removeRelatedTopic/",c,function(d){$("#relatedTopicsView").html(d.topics_table);$("#relatedTopicsModify").html(d.topics_table);todo.configureRelatedTopicsTable()})};todo.configureRelatedTopicsTable=function(){$("#relatedTopicsTable .relatedTopicLink").each(function(){var a=$(this);var b=a.attr("id").split("_")[1];a.click(function(){todo.hideToDoDetails();site.tabs.tabs("select",1);discuss.displayCurrentDiscussion(b);return false})});$("#relatedTopicsView .relatedTopicRemoveLink").each(function(){var a=$(this);var b=a.attr("id").split("_")[1];a.click(function(){todo.removeRelatedTopic(b,todo.details.id);return false})});$("#relatedTopicsModify .relatedTopicRemoveLink").each(function(){var a=$(this);var b=a.attr("id").split("_")[1];a.click(function(){todo.removeRelatedTopic(b,todo.details.id);return false})})};todo.removeRelatedFile=function(b,a){var c={site:site.siteID(),item:b,todo:a};gen.jsonPost(window.location.pathname+"/todos/removeRelatedFile/",c,function(d){$("#relatedFilesView").html(d.files_table);$("#relatedFilesModify").html(d.files_table);todo.configureRelatedFilesTable()})};todo.configureRelatedFilesTable=function(){$("#relatedFilesTable .relatedFileLink").each(function(){var a=$(this);var b=a.attr("href");a.attr("href",site.media_url+"/storage/"+site.url+"/"+b)});$("#relatedFilesView .relatedFileRemoveLink").each(function(){var a=$(this);var b=a.attr("id").split("_")[1];a.click(function(){todo.removeRelatedFile(b,todo.details.id);return false})});$("#relatedFilesModify .relatedFileRemoveLink").each(function(){var a=$(this);var b=a.attr("id").split("_")[1];a.click(function(){todo.removeRelatedFile(b,todo.details.id);return false})})};var cal=new Object();cal.defaultDate=new Date();cal.currentDate=cal.defaultDate;cal.currFirstDay=null;cal.currLastDay=null;cal.updateCalendar=function(){cal.updateHeader();cal.setFirstAndLastDayInMonth(1);cal.addAllRows()};cal.setupButtons=function(){$("#calPrevMonthButton").click(function(a){cal.changeMonth(-1);cal.updateCalendar()});$("#calNextMonthButton").click(function(a){cal.changeMonth(1);cal.updateCalendar()})};cal.changeMonth=function(a){cal.currentDate.setMonth(cal.currentDate.getMonth()+a)};cal.setFirstAndLastDayInMonth=function(b){var a=cal.currentDate;cal.currFirstDay=(new Date(a.getFullYear(),a.getMonth(),1)).getDay()-b;cal.currLastDay=(new Date(a.getFullYear(),(a.getMonth()+1),0)).getDay()-b;if(b==1){cal.currFirstDay=cal.currFirstDay<0?6:cal.currFirstDay;cal.currLastDay=cal.currLastDay<0?6:cal.currLastDay}};cal.getFirstDate=function(a,b){return(new Date(a,b,1)).getDate()};cal.getLastDate=function(a,b){return(new Date(a,(b+1),0)).getDate()};cal.getWeeksInMonth=function(){var a=cal.currentDate;if(cal.currFirstDay==0&&a.getMonth()==1){return 4}else{if(cal.currFirstDay<cal.currLastDay||a.getMonth()==1){return 5}else{return 6}}};cal.setupCalEvents=function(){$calCells=$("#calTable td");$calCells.droppable({hoverClass:"calCellActive",tolerance:"pointer",accept:".todo",drop:cal.createNewEventFromDrop});$calCells.sortable({connectWith:".calCell",items:"div:not(.calDate)",over:function(a,b){$(this).toggleClass("calCellActive")},out:function(a,b){$(this).toggleClass("calCellActive")},receive:cal.createNewEventFromDrop,start:function(a,b){todo.isActive=false},stop:function(a,b){setTimeout(function(){todo.isActive=true},300)}})};cal.updateHeader=function(){var a=new Array(12);a[0]="January";a[1]="February";a[2]="March";a[3]="April";a[4]="May";a[5]="June";a[6]="July";a[7]="August";a[8]="September";a[9]="October";a[10]="November";a[11]="December";$("#calMonth").html(a[cal.currentDate.getMonth()]+" "+cal.currentDate.getFullYear())};cal.addAllRows=function(){var s=0;var q;var j=cal.currentDate;var u=new Date(j.getTime());var h=new Date(j.getTime());var a=new Date(j.getTime());var g;var e;var c;var n;u.setMonth(u.getMonth()-1);a.setMonth(a.getMonth()+1);var r=cal.getWeeksInMonth();var p="";var o=true;var t=cal.getLastDate(j.getFullYear(),(j.getMonth()-1))-cal.currFirstDay;var m=cal.getLastDate(j.getFullYear(),(j.getMonth()-1));var l=cal.getLastDate(j.getFullYear(),j.getMonth());var b=0;var k=0;var d=0;switch(r){case 4:p="25%";break;case 5:p="20%";break;case 6:p="16.67%";break}q='<table id="calTable" class="calTable">';for(var i=0;i<r;i++){q+='<tr style="height: '+p+';">';for(var f=0;f<7;f++){if((t+b)<m){b++;s=t+b;o=true;u.setDate(s);g=u}else{if(k==l){d++;s=d;o=true;a.setDate(s);g=a}else{k++;s=k;o=false;h.setDate(s);g=h}}((g.getMonth()+1)>=0&&(g.getMonth()+1)<=9)?c="0"+(g.getMonth()+1):c=""+(g.getMonth()+1);(g.getDate()>=0&&g.getDate()<=9)?n="0"+g.getDate():n=""+g.getDate();e="cal_"+g.getFullYear()+"-"+c+"-"+n;if(o){q+='<td id="'+e+'" class="calCell calCellDiffMonth"><div class="calDate">'+s+"</div></td>"}else{q+='<td id="'+e+'" class="calCell"><div class="calDate">'+s+"</div></td>"}}q+="</tr>"}q+="</table>";$("#calTable").replaceWith(q);cal.setupCalEvents();cal.createAllEvents()};cal.createNewEventFromDrop=function(b,d){var a;if(d.draggable){a=d.draggable.attr("id").split("_")[1]}else{if(d.item){a=d.item.attr("id").split("_")[1]}}var e=$(this).attr("id").split("_")[1];var c={id:a,due_date:e};gen.jsonPost(window.location.pathname+"/todos/updateToDoDate/",c,function(f){todo.updateToDoItem(f);cal.updateCalEvent(f.id)})};cal.createNewEvent=function(b){var c=todo["id_"+b].title;var a="calEvent_"+b;$("#"+a).remove();return $('<div id="'+a+'" class="calEvent ui-state-default"><span>'+c+"</span></div>")};cal.updateCalEvent=function(b){var a=cal.createNewEvent(b);$("#cal_"+todo["id_"+b].due_date).append(a);$("#calEvent_"+b).ellipsis().data("id",b)};cal.createAllEvents=function(){for(var a=0;a<todo.allToDos.length;a++){cal.updateCalEvent(todo[todo.allToDos[a]].id)}};$(function(){cal.updateCalendar();cal.setupButtons()});var discuss=new Object();$(function(){discuss.showAllDiscussions(false);discuss.setupDroppables()});discuss.initialData=null;discuss.newDiscussionForm=null;discuss.allDiscussions=null;discuss.current_topic=null;discuss.loadData=function(a){discuss.initialData=a;discuss.newDiscussionForm=a.new_discussion_form;discuss.allDiscussions=a.all_discussions;discuss.displayAllDiscussions()};discuss.loadHash=function(){if(gen.hashTabArray.length==0){site.tabs.tabs("select",1)}else{var a=gen.hashTabArray[0].split("_");site.tabs.tabs("select",1);discuss.displayCurrentDiscussion(a[1])}};discuss.showAllDiscussions=function(a){$("#allDicussions").show();$("#currentDiscussion").hide();$("#newDiscussion").hide();gen.button("discussActionButton","Create New Discussion",discuss.createNewDiscussionForm,a);gen.button("discussCancelButton","Refresh",discuss.getAllDiscussions,false)};discuss.createNewDiscussionForm=function(){$("#allDicussions").hide();$("#currentDiscussion").hide();$("#newDiscussion").html(discuss.newDiscussionForm).show();$("#id_body").elastic();gen.button("discussActionButton","Save",discuss.saveNewDiscussion,true);gen.button("discussCancelButton","Cancel",discuss.cancelNewDiscussionForm,false);var a={site:site.siteID()};gen.json(window.location.pathname+"/discuss/createEmptyDiscussion/",a,function(b){$("#new_discussion_id").val(b.id);discuss.current_topic=b.id})};discuss.cancelNewDiscussionForm=function(){discuss.showAllDiscussions(true);var a={site:site.siteID(),discussion:$("#new_discussion_id").val()};gen.jsonPost(window.location.pathname+"/discuss/deleteEmptyDiscussion/",a,function(b){$("#new_discussion_id").val(b.id)})};discuss.saveNewDiscussion=function(){var b=$("#newDiscussionForm").serialize();var a=$("#new_discussion_id").val();gen.jsonPost(window.location.pathname+"/discuss/saveNewDiscussion/",b,function(c){if(c.success){discuss.getAllDiscussions();discuss.showAllDiscussions(true)}else{$("#newDiscussion").html(c.form);gen.restyleErrorForm(c);$("#new_discussion_id").val(a)}})};discuss.getAllDiscussions=function(){var a={site:site.siteID()};gen.json(window.location.pathname+"/discuss/displayAllDiscussions/",a,function(b){discuss.allDiscussions=b.all_discussions;discuss.displayAllDiscussions()},"Loading...")};discuss.displayAllDiscussions=function(){$("#allDicussions").html(discuss.allDiscussions);$("#allDiscussionsTable .pointer").each(function(){var a=$(this);var b=a.attr("id").split("_")[1];a.data("id",b).click(function(){return discuss.displayCurrentDiscussion(b)})}).droppable({hoverClass:"droppableHover",tolerance:"pointer",accept:".todo",drop:discuss.dropAllDiscussions})};discuss.dropAllDiscussions=function(c,d){var a=c.target.id.split("_")[1];var b=d.draggable.attr("id").split("_")[1];discuss.assignRelatedToDo(a,b,null)};discuss.assignRelatedToDo=function(a,b,d){var c={site:site.siteID(),item:a,todo:b};gen.jsonPost(window.location.pathname+"/discuss/assignRelatedToDo/",c,function(e){if(d!=null){d(e)}})};discuss.removeRelatedToDo=function(a,b,d){var c={site:site.siteID(),item:a,todo:b};gen.jsonPost(window.location.pathname+"/discuss/removeRelatedToDo/",c,function(e){if(d!=null){d(e)}})};discuss.setupDroppables=function(){$("#currentDiscussion").droppable({hoverClass:"droppableHover",tolerance:"pointer",accept:".todo",drop:discuss.dropPostCurrentDiscussion});$("#newDiscussion").droppable({hoverClass:"droppableHover",tolerance:"pointer",accept:".todo",drop:discuss.dropPostNewDiscussion})};discuss.configureRelatedToDosTable=function(){$("#relatedToDosTable .relatedToDoDetailsLink").each(function(){var a=$(this);var b=a.attr("id").split("_")[1];a.data("id",b).click(todo.showToDoDetails)});$("#relatedFilesTable .relatedFileLink").each(function(){var a=$(this);var b=a.attr("href");a.attr("href",site.media_url+"/storage/"+site.url+"/"+b)});$("#relatedTodosCurrent .relatedToDoRemoveLink").each(function(){var a=$(this);var b=a.attr("id").split("_")[1];a.data("id",b).click(function(){discuss.removeRelatedToDo(discuss.current_topic,b,discuss.dropResponseCurrentDiscussion);return false})});$("#relatedTodosNew .relatedToDoRemoveLink").each(function(){var a=$(this);var b=a.attr("id").split("_")[1];a.data("id",b).click(function(){discuss.removeRelatedToDo(discuss.current_topic,b,discuss.dropResponseNewDiscussion);return false})})};discuss.dropPostCurrentDiscussion=function(c,d){var a=discuss.current_topic;var b=d.draggable.attr("id").split("_")[1];discuss.assignRelatedToDo(a,b,discuss.dropResponseCurrentDiscussion)};discuss.dropResponseCurrentDiscussion=function(a){$("#relatedTodosCurrent").empty().html(a.todos_table);discuss.configureRelatedToDosTable();$("#currentDiscussion").attr({scrollTop:100000})};discuss.dropPostNewDiscussion=function(c,d){var a=discuss.current_topic;var b=d.draggable.attr("id").split("_")[1];discuss.assignRelatedToDo(a,b,discuss.dropResponseNewDiscussion)};discuss.dropResponseNewDiscussion=function(a){$("#relatedTodosNew").empty().html(a.todos_table);discuss.configureRelatedToDosTable();$("#newDiscussion").attr({scrollTop:100000})};discuss.displayCurrentDiscussion=function(a){gen.button("discussActionButton","Reply",discuss.addReplyToCurrentDiscussion,true);gen.button("discussCancelButton","Back",discuss.showAllDiscussions,false);discuss.current_topic=a;gen.setHash("/Discuss/topic_"+a);var b={site:site.siteID(),id:a};gen.json(window.location.pathname+"/discuss/displayCurrentDiscussion/",b,function(c){$("#topic_"+a+" td").css("font-weight","");$("#currentDiscussion").html(c.current_discussion).show().attr({scrollTop:0});$("#allDicussions").hide();$("#newDiscussion").hide();discuss.configureRelatedToDosTable()},"Loading...");return false};discuss.addReplyToCurrentDiscussion=function(){$("#currentDiscussionsTable").append('<tr><th>Reply</th><td class="formTable"><textarea id="reply_id" name="reply"></textarea></td></tr>');gen.button("discussActionButton","Save",discuss.saveReplyToCurrentDiscussion,false);$("#reply_id").focus().elastic({onResize:function(){gen.scrollWithTextarea("currentDiscussion")}});$("#currentDiscussion").attr({scrollTop:100000})};discuss.saveReplyToCurrentDiscussion=function(){var a=$("#reply_id");if($.trim(a.val())==""){a.css({border:"1px solid red"});return}var b={site:site.siteID(),body:a.val(),topic:discuss.current_topic};gen.jsonPost(window.location.pathname+"/discuss/saveCurrentDiscussionReply/",b,function(d){var c="";$("#currentDiscussionsTable tr:last").remove();if($("#currentDiscussionsTable tr:last").attr("class")==""){c="tableAltRow"}var e='<tr class="'+c+'"><th>'+d.author+"<br />"+d.created+"</th><td>"+d.body+"</td></tr>";$("#currentDiscussionsTable").append(e);gen.button("discussActionButton","Reply",discuss.addReplyToCurrentDiscussion,true);discuss.getAllDiscussions()})};var files=new Object();files.loadData=function(a){files.displayAllFiles(a);gen.button("filesActionButton","Refresh",files.getAllFiles,false);$("#uploadify").uploadify({uploader:"/static/js/uploadify.swf",script:"http://"+window.location.host+"/"+site.url+"/files/fileUploads/",cancelImg:site.media_url+"/images/cancel.png",folder:"/static/storage",queueID:"uploadifyQueue",auto:true,multi:true,scriptAccess:"always",buttonText:"Upload File(s)",scriptData:{user:site.user},onSelectOnce:function(c,b){$("#filesTut").hide();$("#uploadifyQueue").show()},onAllComplete:function(c,b){$("#uploadifyQueue").hide();$("#filesTut").show();files.getAllFiles()}});$("#uploadifyUploader").attr("title","Select multiple files at once to upload").css("cursor","pointer")};files.loadHash=function(){site.tabs.tabs("select",2)};files.getAllFiles=function(){var a={site:site.siteID()};gen.json(window.location.pathname+"/files/displayAllFiles/",a,function(b){files.displayAllFiles(b)},"Loading...")};files.displayAllFiles=function(a){$("#allFilesTable").replaceWith(a.all_files);$("#allFilesTable .pointer a").each(function(){var c=$(this);var b=c.attr("href");var d=c.parent().parent();d.click(function(){window.open(b)});c.click(function(){d.click();return false});d.droppable({hoverClass:"droppableHover",tolerance:"pointer",accept:".todo",drop:files.dropAllFiles})})};files.dropAllFiles=function(c,d){var b=c.target.id.split("_")[1];var a=d.draggable.attr("id").split("_")[1];files.assignRelatedToDo(b,a,null)};files.assignRelatedToDo=function(b,a,d){var c={site:site.siteID(),item:b,todo:a};gen.jsonPost(window.location.pathname+"/files/assignRelatedToDo/",c,function(e){if(d!=null){d(e)}})};